# 程序员修炼之道（二）

## 第二章 注重实效的途径

**DRY原则**：系统中的每一项只是都必须具有单一、无歧义、权威的表示。

- 强加的重复：

  - 信息的多重表示。编写简单的过滤器或代码生成器，可以在每次构建软件时，使用简单的代码生成器，根据公共的元数据表示构建多各种语言下单的结构。可以根据在线数据库schema、或是最初用于构建schema的元数据，自动生成类定义。这本书就是一个例子：这本书中摘录的代码，由预处理器在作者每次对文本进行格式化时插入。**诀窍**就是让该过程成为主动的，这不能是一次性转换，否则就会回退到重复数据的情况。

  - 代码中的文档。糟糕的代码才需要注释，我们需要把低级的知识放在代码中，它属于那里；把注释保留给其他的高级说明。否则，我们就是在重复知识，而每一次改变都意味着既要改变代码，也要改变注释。举个反面例子

    ```c
    int d;   //d 是直径
    ```

    这样就犯了低级的知识放在了代码中的错误，好的方法是这么写：

    ```c
    int diamiter;   
    ```

    这样不需要注释也知道这个是直径。

  - 文档与代码。文档和代码都含有同一知识的表示。

  - 语言问题。

- 无意的重复：

  - 例子：一个表示线段的类

    ```c++
    class Line{
      public:
       Point start;
       Point end;
       double length;
    }
    ```

    重复原因：每改变一个点，都要改变长度，重复！

    好的写法：

    ```c++
    class Line{
      public:
       Point start;
       Point end;
       double length(){ return start.dictanceTo(end); }
    }
    ```

  - 有时为了性能而选择违反DRY原则。通常：需要缓存数据，以避免重复昂贵的操作时。其诀窍是使影响局部化。对DRY原则的违反没有暴露给外界：只有类中的方法需要注意“保持行为良好”。

    ​

    ​

